{% extends "patterns/base.html" %}

{% load static wagtailuserbar wagtailcore_tags wagtailimages_tags navigation_tags util_tags %}

{% block meta_tags %}
    {% if GOOGLE_TAG_MANAGER_ID %}
        {# To enable GTM code you need to specify GOOGLE_TAG_MANAGER_ID in Django settings #}
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','{{ GOOGLE_TAG_MANAGER_ID|escapejs }}');</script>
    {% endif %}

    {# favicons #}
    {% comment %}
        Generate favicons by http://realfavicongenerator.net and select the option to serve files up from the root of the site.
        Place all the files generated by realfavicon generator in the "public" folder in the application root, and they will be served up from the root of the site by whitenoise.
    {% endcomment %}

    {% comment %}
        Twitter summary card - see https://dev.twitter.com/cards/types/summary
        and https://dev.twitter.com/cards/getting-started
    {% endcomment %}
    {% wagtail_site as current_site %}
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@{{ settings.utils.SocialMediaSettings.twitter_handle }}" />
    <meta name="twitter:title" content="{{ page.title }}" />
    <meta name="twitter:description" content="{{ page|social_text:current_site }}">
    {% if page.social_image  %}
        {% image page.social_image width-1000 as social_img %}
        {# This will give a full path to the image when on staging or production because S3 storage is used. If testing locally, make sure you use the default localhost:8000 url. Testing via :3000 will give peculiar results. #}
        <meta name="twitter:image" content="{{ social_img.url }}">
        {% if social_img.alt %}
            <meta name="twitter:image:alt" content="{{ social_img.alt }}">
        {% endif %}
    {% else %}
        {% comment %}
        An example of how to add a default image to use for social sharing in case one is not provided on the page.
        Note that you need to explicitly add the root url here as the static path will not include it
        <meta name="twitter:image" content="{{ current_site.root_url }}{% static 'images/social-image.png' %}">
        {% endcomment %}
    {% endif %}

    {# facebook opengraph tags #}
    <meta property="fb:app_id" content="{{ settings.utils.SocialMediaSettings.facebook_app_id }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ site.root_url }}{{ page.url }}" />
    <meta property="og:title" content="{{ page.title }}" />
    {% if page.social_image %}
        {% image page.social_image width-1200 height-630 as social_img %}
        {# This will give a full path to the image when on staging or production because S3 storage is used. If testing locally, make sure you use the default localhost:8000 url. Testing via :3000 will give peculiar results. #}
        <meta property="og:image" content="{{ social_img.url }}" />
        <meta property="og:image:width" content="{{ social_img.width }}" />
        <meta property="og:image:height" content="{{ social_img.height }}" />
    {% else %}
        {% comment %}
        An example of how to add a default image to use for social sharing in case one is not provided on the page.
        Note that you need to explicitly add the root url here as the static path will not include it
        <meta name="twitter:image" content="{{ current_site.root_url }}{% static 'images/social-image.png' %}">
        {% endcomment %}
    {% endif %}
    <meta property="og:description" content="{{ page|social_text:current_site }}" />
    <meta property="og:site_name" content="{{ settings.utils.SocialMediaSettings.site_name }}" />
{% endblock meta_tags %}


{% block body_top %}
    {% if GOOGLE_TAG_MANAGER_ID %}
        {# To enable GTM code you need to specify GOOGLE_TAG_MANAGER_ID in Django settings #}
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ GOOGLE_TAG_MANAGER_ID|urlencode }}"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    {% endif %}
{% endblock body_top %}


{% block header %}
{% include "patterns/molecules/skip-link/skip-link.html" %}
    <header class="header">
        <div class="header__inner wrapper wrapper--large">
            <a href="/">
                <img class="header__logo" src="https://placehold.it/150x100" alt="Logo for Torchbox">
            </a>

            <div class="header__menu-toggle">
                <span>Menu</span>
                <button class="button button-menu-toggle" data-mobile-menu-toggle aria-haspopup="true" aria-label="Mobile menu toggle">
                    <span class="button-menu-toggle__line"></span>
                    <span class="button-menu-toggle__line"></span>
                    <span class="button-menu-toggle__line"></span>
                    <span class="button-menu-toggle__line"></span>
                </button>
            </div>

            <div class="header__menus header__menus--desktop">
                <div class="header__inner--top">
                    {% secondarynav %}
                    <form action="{% url 'search' %}" method="get" role="search" class="form form--header-search">
                        <input class="input" id="search" type="text" placeholder="Search…" name="query"{% if search_query %} value="{{ search_query }}"{% endif %}>
                        <label class="u-sr-only" for="search">Search this website</label>
                        <button class="button" type="submit">
                            {% include "patterns/atoms/icons/icon.html" with name="magnifying-glass" %}
                            <span class="u-sr-only">Search</span>
                        </button>
                    </form>
                </div>

                {% primarynav %}
            </div>

            <div class="header__menus header__menus--mobile" data-mobile-menu>
                {% primarynav %}
            </div>
        </div>
    </header>
{% endblock header %}

{% block footer %}
    <footer class="footer">
        <div class="footer__inner wrapper wrapper--large">
            <div class="footer__nav-container">
                {% if settings.utils.SocialMediaSettings.twitter_handle or settings.utils.SocialMediaSettings.facebook_app_id %}
                    <div class="footer__social-links">
                        <p class="heading--5 footer__heading">Follow us:</p>
                        {% if settings.utils.SocialMediaSettings.twitter_handle %}
                            <a href="https://twitter.com/{{ settings.utils.SocialMediaSettings.twitter_handle }}">
                                {% include "patterns/atoms/icons/icon.html" with name="twitter" classname="icon--footer-social" %}
                            </a>
                        {% endif %}
                        {% if settings.utils.SocialMediaSettings.facebook_app_id %}
                            <a href="https://www.facebook.com/{{ settings.utils.SocialMediaSettings.facebook_app_id }}">
                                {% include "patterns/atoms/icons/icon.html" with name="facebook" classname="icon--footer-social" %}
                            </a>
                        {% endif %}
                    </div>
                {% endif %}

                <div>
                    {% footernav %}
                </div>

                <div>
                    {% footerlinks %}
                </div>
            </div>

            <div class="footer__credit">
                {% if COPYRIGHT %}
                    <p>© {% now "Y" %} {{ COPYRIGHT }}</p>
                {% endif %}
                <div>Site by <a href="https://torchbox.com/">Torchbox</a></div>
            </div>
        </div>
    </footer>

    {% include "patterns/molecules/cookie-message/cookie-message.html" %}
{% endblock footer %}

