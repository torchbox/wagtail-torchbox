{% extends "torchbox/base.html" %}
{% load static torchbox_tags wagtailcore_tags wagtailimages_tags %}
{% block googlemap %}
    <script src="https://maps.googleapis.com/maps/api/js"></script>
{% endblock %}
{% block content %}

<div class="map" id="map"></div>
<div class="contact-bar">
    <div class="contact-bar__item">+44 (0) 1608 811870</div>
    <div class="contact-bar__item">
        <a href="mailto:hello@torchbox.com">hello@torchbox.com</a>
    </div>
</div>
<div class="container">
    <div class="main-content">
        <div class="contact">
            <form class="contact-form" action="{% pageurl page %}" method="post" id="contact-us-form">
                <fieldset class="contact-form__group">
                    <h1>Drop us a line</h1>
                    {{ page.intro|richtext }}
                    {% csrf_token %}
                    {% spaceless %}
                    {% for field in form %}
                        <div class="contact-form__row contact-form__row--{{ field.id_for_label }}">
                            {{ field.errors }}
                            <label for="{{ field.id_for_label }}" class="contact-form__label {% if field.field.required %} contact-form__label--required {% endif %}">
                                {{ field.label }}
                            </label>
                            {{ field }}
                        </div>
                    {% endfor %}
                    {% endspaceless %}
                    <button type="submit" class="contact-form__submit" id="contact-us-submit">Submit</button>
                </fieldset>    
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="text/javascript">

    $(function() {
        var markers         = [],
            zoomMin         = 5, 
            center          = '45, -30'
            mapCenter       = center.split(','),
            mapZoom         = null,
            locations       = [
                        [51.858469, -1.480863],     // Oxford
                        [51.454814, -2.597802],     // Bristol
                        [39.950865, -75.145590]     // Philadelphia
            ];

        var map = new google.maps.Map(document.getElementById('map'), {

            // Set map options
            center:         new google.maps.LatLng(mapCenter[0], mapCenter[1]),
            mapTypeId:      google.maps.MapTypeId.ROADMAP,
            zoom:           4,
            scrollwheel:    false,
            styles: [{"featureType":"all","elementType":"labels.text.fill","stylers":[{"saturation":36},{"color":"#000000"},{"lightness":40}]},{"featureType":"all","elementType":"labels.text.stroke","stylers":[{"visibility":"on"},{"color":"#000000"},{"lightness":16}]},{"featureType":"all","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"administrative","elementType":"geometry.fill","stylers":[{"lightness":"69"}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#000000"},{"lightness":17},{"weight":1.2}]},{"featureType":"administrative.country","elementType":"geometry","stylers":[{"lightness":"35"}]},{"featureType":"administrative.country","elementType":"geometry.fill","stylers":[{"lightness":"1"}]},{"featureType":"administrative.province","elementType":"geometry.fill","stylers":[{"weight":"3.94"},{"lightness":"45"}]},{"featureType":"landscape","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":20}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":21}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#000000"},{"lightness":17}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#000000"},{"lightness":29},{"weight":0.2}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":18}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":16}]},{"featureType":"transit","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":19}]},{"featureType":"water","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":17}]}]
        });

        function createMarkers() {
            for (var i = 0; i < locations.length; i++) {

                var marker = new google.maps.Marker({

                    map: map,
                    icon: '{% static "torchbox/images/pin.png" %}',
                    position: new google.maps.LatLng(locations[i][0], locations[i][1]),

                });

                markers.push(marker);
            }   
        }

        function positionMap(){

            var bounds = new google.maps.LatLngBounds();
            for (var i = 0; i < markers.length; i++) {
                bounds.extend(markers[i].getPosition());
            }
            map.fitBounds(bounds);
        }

        // Hide a single marker/list of markers
        // Refactor to pass location name
        function hideMarkers() {
            markers[1].setMap(null);
        }

        // Show all markers
        function showAllMarkers() {
            for (var i = 0; i < locations.length; i++) {    
                markers[i].setMap(map);
            }
        }

        // On user zoom change
        function zoomChange() {
           google.maps.event.addListener(map, 'zoom_changed', function() {

                mapZoom = map.getZoom();

                // When zoomed out
                if ( mapZoom < zoomMin ) {
                    hideMarkers();
                }

                // When zoomed in
                else {
                    showAllMarkers();
                }
           }); 
        }

        createMarkers();
        hideMarkers();
        zoomChange();
        positionMap();
    
    });

</script>
{% endblock %}